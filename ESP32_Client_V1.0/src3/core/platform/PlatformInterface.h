/*
 * PlatformInterface.h - V2.0 Platform Abstraction Interface
 *
 * Part of the Mechanical MIDI Music V2.0 redesign
 * Based on REDESIGN_PART6_IMPLEMENTATION.md specifications
 *
 * Provides a unified interface for platform-specific functionality
 * to enable easy porting between different microcontrollers.
 */

#pragma once

#include <cstdint>

////////////////////////////////////////////////////////////////////////////////////////////////////
// Platform Capabilities Structure
////////////////////////////////////////////////////////////////////////////////////////////////////

struct PlatformCapabilities {
    bool hasHardwarePWM = false;    // Hardware PWM generation support
    bool hasWiFi = false;           // WiFi networking support
    bool hasBLE = false;            // Bluetooth Low Energy support
    bool hasNVS = false;            // Non-volatile storage support
    bool hasHardwareTimer = false;  // Hardware timer interrupt support
    uint32_t maxFlashSize = 0;      // Maximum flash memory (bytes)
    uint32_t maxRAM = 0;            // Maximum RAM (bytes)
    uint32_t maxFrequency = 0;      // Maximum CPU frequency (Hz)
    uint8_t maxPinNumber = 0;       // Highest valid pin number
};

////////////////////////////////////////////////////////////////////////////////////////////////////
// Platform Abstract Interface
////////////////////////////////////////////////////////////////////////////////////////////////////

class Platform {
public:
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    // Initialization
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    
    // Initialize platform-specific features
    static void init();
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    // Timing Functions
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    
    // Get microsecond timestamp
    static uint32_t micros();
    
    // Get millisecond timestamp  
    static uint32_t millis();
    
    // Delay in microseconds
    static void delayMicroseconds(uint32_t us);
    
    // Delay in milliseconds
    static void delayMilliseconds(uint32_t ms);
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    // Information
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    
    // Get platform capabilities
    static PlatformCapabilities getCapabilities();
    
    // Get platform name
    static const char* getName();
    
    // Get platform version
    static const char* getVersion();
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    // Pin Management (Optional - can be overridden)
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    
    // Check if pin number is valid
    static bool isValidPin(uint8_t pin);
    
    // Check if pin supports PWM output
    static bool pinSupportsPWM(uint8_t pin);
    
    // Check if pin is input-only
    static bool pinIsInputOnly(uint8_t pin);
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    // Memory Management
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    
    // Get free heap memory
    static uint32_t getFreeHeap();
    
    // Get minimum free heap since boot
    static uint32_t getMinFreeHeap();
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    // Watchdog and Reset
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    
    // Feed the watchdog timer
    static void feedWatchdog();
    
    // Restart the system
    static void restart();
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    // Debug and Diagnostics
    ////////////////////////////////////////////////////////////////////////////////////////////////////
    
    // Print platform information
    static void printInfo();
};